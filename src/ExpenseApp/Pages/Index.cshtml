@page
@model ExpenseApp.Pages.IndexModel
@{
    ViewData["Title"] = "Dashboard";
}

<div class="dashboard-hero">
    <div class="container">
        <h1 class="hero-title">Expense Management</h1>
        <p class="hero-subtitle">Track, submit and approve business expenses</p>
    </div>
</div>

<div class="container mt-4">

    @if (!string.IsNullOrEmpty(Model.DbError))
    {
        <div class="alert alert-warning alert-dismissible d-flex align-items-start gap-3" role="alert">
            <i class="bi bi-exclamation-triangle-fill fs-4 text-warning mt-1"></i>
            <div>
                <strong>Database connection issue – showing sample data</strong><br />
                <span class="text-muted small">@Model.DbError</span>
            </div>
            <button type="button" class="btn-close ms-auto" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Summary cards -->
    <div class="row g-3 mb-4">
        @foreach (var s in Model.Summary)
        {
            <div class="col-6 col-md-3">
                <div class="card summary-card shadow-sm h-100">
                    <div class="card-body text-center">
                        <p class="summary-label mb-1">@s.StatusName</p>
                        <p class="summary-count mb-0">@s.TotalCount</p>
                        <p class="summary-amount text-muted small mb-0">£@s.TotalAmountGBP.ToString("F2")</p>
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Quick links -->
    <h5 class="mb-3 fw-semibold">Quick actions</h5>
    <div class="row g-3">
        <div class="col-12 col-md-4">
            <a href="/Expenses" class="card quick-link-card shadow-sm text-decoration-none">
                <div class="card-body d-flex align-items-center gap-3">
                    <span class="quick-link-icon bg-primary-subtle text-primary"><i class="bi bi-receipt-cutoff"></i></span>
                    <div>
                        <p class="fw-semibold mb-0">Expenses</p>
                        <p class="text-muted small mb-0">View, add and manage expenses</p>
                    </div>
                    <i class="bi bi-chevron-right ms-auto text-muted"></i>
                </div>
            </a>
        </div>
        <div class="col-12 col-md-4">
            <a href="/Users" class="card quick-link-card shadow-sm text-decoration-none">
                <div class="card-body d-flex align-items-center gap-3">
                    <span class="quick-link-icon bg-success-subtle text-success"><i class="bi bi-people"></i></span>
                    <div>
                        <p class="fw-semibold mb-0">Users</p>
                        <p class="text-muted small mb-0">Manage employees and managers</p>
                    </div>
                    <i class="bi bi-chevron-right ms-auto text-muted"></i>
                </div>
            </a>
        </div>
        <div class="col-12 col-md-4">
            <a href="/Categories" class="card quick-link-card shadow-sm text-decoration-none">
                <div class="card-body d-flex align-items-center gap-3">
                    <span class="quick-link-icon bg-warning-subtle text-warning"><i class="bi bi-tags"></i></span>
                    <div>
                        <p class="fw-semibold mb-0">Categories</p>
                        <p class="text-muted small mb-0">Configure expense categories</p>
                    </div>
                    <i class="bi bi-chevron-right ms-auto text-muted"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- Recent expenses -->
    <h5 class="mt-4 mb-3 fw-semibold">Recent expenses</h5>
    <div class="card shadow-sm">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>User</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.RecentExpenses.Any())
                    {
                        <tr><td colspan="7" class="text-center text-muted py-4">No expenses found.</td></tr>
                    }
                    @foreach (var e in Model.RecentExpenses)
                    {
                        <tr>
                            <td class="text-muted small">#@e.ExpenseId</td>
                            <td>@e.UserName</td>
                            <td>@e.CategoryName</td>
                            <td>@e.ExpenseDate.ToString("dd MMM yyyy")</td>
                            <td class="fw-semibold">@e.AmountFormatted</td>
                            <td><span class="badge @StatusBadge(e.StatusName)">@e.StatusName</span></td>
                            <td><a href="/Expenses/Detail?id=@e.ExpenseId" class="btn btn-sm btn-outline-secondary">View</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
    <div class="mt-2 text-end">
        <a href="/Expenses" class="text-decoration-none small">View all expenses →</a>
    </div>
</div>

@functions {
    static string StatusBadge(string status) => status switch
    {
        "Approved"  => "bg-success",
        "Rejected"  => "bg-danger",
        "Submitted" => "bg-warning text-dark",
        _           => "bg-secondary",
    };
}
